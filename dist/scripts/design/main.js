!function(t){"use strict";function e(e){if(t.getComputedStyle){var o=getComputedStyle(e),i=o.transform||o.webkitTransform||o.mozTransform,r=i.match(/^matrix3d\((.+)\)$/);return r?parseFloat(r[1].split(", ")[13]):(r=i.match(/^matrix\((.+)\)$/),r?parseFloat(r[1].split(", ")[5]):0)}}function o(){return t.pageYOffset||d.scrollTop}function i(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function r(t,e){this.isolayerEl=t,this.options=i({},this.options),i(this.options,e),this.gridEl=this.isolayerEl.querySelector(".grid"),this.gridItems=[].slice.call(this.gridEl.querySelectorAll(".grid__item")),this.gridItemsTotal=this.gridItems.length,this.didscroll=!1,this._init()}for(var s,n=0,l="webkit moz ms o".split(" "),a=t.requestAnimationFrame,c=t.cancelAnimationFrame,p=0;p<l.length&&(!a||!c);p++)s=l[p],a=a||t[s+"RequestAnimationFrame"],c=c||t[s+"CancelAnimationFrame"]||t[s+"CancelRequestAnimationFrame"];a&&c||(a=function(e,o){var i=(new Date).getTime(),r=Math.max(0,16-(i-n)),s=t.setTimeout(function(){e(i+r)},r);return n=i+r,s},c=function(e){t.clearTimeout(e)});var d=t.document.documentElement;r.prototype.options={type:"static",perspective:0,transform:"",stackItemsAnimation:{properties:function(t){return{translateZ:50*(t+1)}},options:function(t,e){return{type:dynamics.bezier,duration:500,points:[{x:0,y:0,cp:[{x:.2,y:1}]},{x:1,y:1,cp:[{x:.3,y:1}]}]}}},onGridLoaded:function(){return!1}},r.prototype._init=function(){var t=this;imagesLoaded(this.gridEl,function(){t.msnry=new Masonry(t.gridEl,{itemSelector:".grid__item",isFitWidth:!0}),"scrollable"===t.options.type&&(t.isolayerEl.style.position="fixed"),t.isolayerEl.style.WebkitTransformStyle=t.isolayerEl.style.transformStyle="preserve-3d";var e=0!=t.options.perspective?"perspective("+t.options.perspective+"px) "+t.options.transform:t.options.transform;t.isolayerEl.style.WebkitTransform=t.isolayerEl.style.transform=e,"scrollable"===t.options.type&&t._createPseudoScroller(),t._initEvents(),"scrollable"===t.options.type&&new AnimOnScroll(t.gridEl,{minDuration:1,maxDuration:1.2,viewportFactor:0}),t.options.onGridLoaded(),classie.add(t.gridEl,"grid--loaded")})},r.prototype._createPseudoScroller=function(){this.pseudoScrollerEl=document.createElement("div"),this.pseudoScrollerEl.className="pseudo-scroller",this.isolayerEl.parentNode.insertBefore(this.pseudoScrollerEl,this.isolayerEl),this.pseudoScrollerEl.style.height=this.gridEl.offsetHeight+e(this.isolayerEl)*Math.sqrt(2)+"px"},r.prototype._initEvents=function(){var e=this,o=function(){a(function(){e.didscroll||(e.didscroll=!0,e._scrollPage())})},i=function(t){e._expandSubItems(t.target)},r=function(t){e._collapseSubItems(t.target)};"scrollable"===this.options.type&&(t.addEventListener("scroll",o,!1),this.msnry.on("layoutComplete",function(t){e.pseudoScrollerEl.style.height=e.gridEl.offsetHeight+e.isolayerEl.offsetTop*Math.sqrt(2)+"px",e._scrollPage()})),this.gridItems.forEach(function(t){t.addEventListener("mouseenter",i),t.addEventListener("mouseleave",r)})},r.prototype._expandSubItems=function(t){var e=this,o=t.querySelector("a"),i=[].slice.call(o.querySelectorAll(".layer")),r=i.length;o.style.zIndex=t.style.zIndex=this.gridItemsTotal,i.forEach(function(t,o){dynamics.stop(t),dynamics.animate(t,e.options.stackItemsAnimation.properties(o),e.options.stackItemsAnimation.options(o,r))})},r.prototype._collapseSubItems=function(t){var e=t.querySelector("a");[].slice.call(e.querySelectorAll(".layer")).forEach(function(o,i){dynamics.stop(o),dynamics.animate(o,{translateZ:0},{duration:100,complete:function(){e.style.zIndex=t.style.zIndex=1}})})},r.prototype._scrollPage=function(){this.gridEl.style.WebkitTransform=this.gridEl.style.transform="translate3d(0,-"+o()+"px,0)",this.didscroll=!1},t.IsoGrid=r}(window);